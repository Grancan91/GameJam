<!doctype html>
<html>

<head>
    <script src="https://pixijs.download/release/pixi.min.js"></script>
</head>

<body>
    <script>
        // Create the application helper and add its render target to the page
        let app = new PIXI.Application({ width: 1280, height: 720 });
        document.body.appendChild(app.view);

        // Add the 'keydown' event listener to our document
        document.addEventListener('keydown', onKeyDown, false);

        /* START SCREEN */

        // Title
        const title = new PIXI.Text('MY PATH', {
            fontFamily: 'Courier New',
            fontSize: 32,
            fontStyle: 'italic',
            fontWeight: 'bold',
            fill: ['#ffffff', '#000000'], // gradient
            stroke: '#FFFF',
            strokeThickness: 5,
            dropShadow: true,
            dropShadowColor: '#c7ffef',
            dropShadowBlur: 4,
            dropShadowAngle: Math.PI / 6,
            dropShadowDistance: 6,
            wordWrap: true,
            wordWrapWidth: 440,
            lineJoin: 'round',
        });
        title.x = app.screen.width / 2.5;
        title.y = 30;
        app.stage.addChild(title);

        // Subtitle
        const subTitle = new PIXI.Text('Please, press X to start.', {
            fontFamily: 'Courier New',
            fontSize: 20,
            fontStyle: 'italic',
            fontWeight: 'bold',
            fill: ['#ffffff', '#d7d7d7'], // gradient
            stroke: '#0000',
            strokeThickness: 5,
            dropShadow: true,
            dropShadowColor: '#c7ffef',
            dropShadowBlur: 4,
            dropShadowAngle: Math.PI / 6,
            dropShadowDistance: 6,
            wordWrap: true,
            wordWrapWidth: 440,
            lineJoin: 'round',
        });
        subTitle.x = app.screen.width / 3.5;
        subTitle.y = 180;
        app.stage.addChild(subTitle);


        /* INSTRUCTIONS SCREEN */

        /* GAME SCREEN */

        // Load required assets 
        let player = PIXI.Sprite.from('bunny.png');
        let enemy  = PIXI.Sprite.from('bunny.png');
        let dsert1 = PIXI.Sprite.from('dsert1x1.png');
        let dsert2 = PIXI.Sprite.from('dsert2x1.png');
        let dsert3 = PIXI.Sprite.from('dsert1x1.png');
        let dsert4 = PIXI.Sprite.from('dsert1x1.png');
        let dsert5 = PIXI.Sprite.from('dsert1x1.png');
        let dsert6 = PIXI.Sprite.from('dsert1x1.png');

        enemy.y = 100
        dsert1.y = 500

        // Adding to screen
        app.stage.addChild(player);
        app.stage.addChild(enemy);
        app.stage.addChild(dsert1);

        // Game executing
        var pSpeed = 2
        var moveY = 0;
        var moveX = 0;

        let elapsed = 0.0;
        app.ticker.add((delta) => {
            update(delta);
        });

        function update(delta) {
            elapsed += delta;
            player.y += moveY
            player.x += moveX
            moveX *= 0.99
            moveY *= 0.99
            console.log(moveX)

            if (hitTestRectangle(player, enemy)) {
                console.log("Colision")
                moveY = 0
                moveX = 0
            } else {
                console.log("Not Collision")
            }
        }

        // Movement
        function onKeyDown(key) {
            switch (key.keyCode) {
                case 87:    // W key
                case 38:    // Up arrow key 
                    moveY = -pSpeed;
                    break;
                case 83:    // S key
                case 40:    // Down arrow key
                    moveY = pSpeed;
                    break;
                case 65:    // A key
                case 37:    // Left arrow key
                    moveX = -pSpeed;
                    break;
                case 68:    // D key
                case 39:    // Right arrow key
                    moveX = pSpeed;
                    break;
                case 88:    // X key
                    //start screen no visibles.
                    break;
            }

        }

        // Collisions
        function hitTestRectangle(r1, r2) {
            //Define the variables we'll need to calculate
            let hit, combinedHalfWidths, combinedHalfHeights, vx, vy;
            //hit will determine whether there's a collision
            hit = false;
            //Find the center points of each sprite
            r1.centerX = r1.x + r1.width / 2;
            r1.centerY = r1.y + r1.height / 2;
            r2.centerX = r2.x + r2.width / 2;
            r2.centerY = r2.y + r2.height / 2;
            //Find the half-widths and half-heights of each sprite
            r1.halfWidth = r1.width / 2;
            r1.halfHeight = r1.height / 2;
            r2.halfWidth = r2.width / 2;
            r2.halfHeight = r2.height / 2;
            //Calculate the distance vector between the sprites
            vx = r1.centerX - r2.centerX;
            vy = r1.centerY - r2.centerY;
            //Figure out the combined half-widths and half-heights
            combinedHalfWidths = r1.halfWidth + r2.halfWidth;
            combinedHalfHeights = r1.halfHeight + r2.halfHeight;
            //Check for a collision on the x axis
            if (Math.abs(vx) < combinedHalfWidths) {
                //A collision might be occurring. Check for a collision on the y axis
                if (Math.abs(vy) < combinedHalfHeights) {
                    //There's definitely a collision happening
                    hit = true;
                } else {
                    //There's no collision on the y axis
                    hit = false;
                }
            } else {
                //There's no collision on the x axis
                hit = false;
            }
            //`hit` will be either `true` or `false`
            return hit;
        };


    </script>
</body>

</html>